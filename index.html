<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOUND NOTES</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;600&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root { --p: #6366f1; --bg: #f8fafc; --danger: #ef4444; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; width: 90%; max-width: 400px; padding: 30px; border-radius: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.05); text-align: center; }
        
        .timer-display { font-family: 'JetBrains Mono', monospace; font-size: 35px; font-weight: bold; color: var(--p); margin: 15px 0; background: #f5f7ff; padding: 15px; border-radius: 20px; border: 2px dashed #cbd5e1; }
        
        .setting-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 12px; background: #f8fafc; padding: 10px 15px; border-radius: 15px; }
        .setting-row select, .setting-row input { border: 1px solid #e2e8f0; padding: 8px; border-radius: 10px; font-family: 'Kanit'; outline: none; color: var(--p); font-weight: 600; }
        .setting-row input { width: 60px; text-align: center; }

        textarea { width: 100%; height: 90px; border: 2px solid #f1f5f9; border-radius: 15px; padding: 15px; font-size: 16px; margin-bottom: 15px; outline: none; transition: 0.3s; resize: none; box-sizing: border-box; font-family: 'Kanit', sans-serif; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 15px; font-size: 15px; font-weight: 600; cursor: pointer; transition: 0.2s; font-family: 'Kanit', sans-serif; }
        
        .btn-perm { background: #eef2ff; color: var(--p); grid-column: span 2; }
        .btn-test { background: white; color: #64748b; border: 1px solid #e2e8f0; grid-column: span 2; margin-bottom: 10px; }
        .btn-start { background: var(--p); color: white; }
        .btn-stop { background: #fee2e2; color: var(--danger); }
        
        .status { font-size: 13px; color: #94a3b8; margin-top: 20px; }
        .working { color: #10b981 !important; font-weight: 600; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="margin:0 0 15px 0">üé∂ SOUND NOTES</h2>
    
    <div id="countdown" class="timer-display">00:00</div>

    <div class="setting-row">
        <span>‚è∞ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤</span>
        <div>
            <input type="number" id="minutesInput" value="30" min="1"> <span>‡∏ô‡∏≤‡∏ó‡∏µ</span>
        </div>
    </div>

    <div class="setting-row">
        <span>üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
        <select id="soundSelect" onchange="previewSound()">
            <option value="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3">Digital Ting</option>
            <option value="https://assets.mixkit.co/active_storage/sfx/1084/1084-preview.mp3">Classic Bell</option>
            <option value="https://assets.mixkit.co/active_storage/sfx/951/951-preview.mp3">Whistle</option>
            <option value="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3">Soft Piano</option>
        </select>
    </div>

    <textarea id="noteInput" placeholder="‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ..."></textarea>
    
    <button class="btn btn-test" onclick="sendNotify()">üîî ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á & ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
    
    <div class="btn-group">
        <button class="btn btn-perm" onclick="requestPermission()">üîì  ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
        <button id="startBtn" class="btn btn-start" onclick="startTimer()"> ‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
        <button id="stopBtn" class="btn btn-stop" onclick="stopTimer()">‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏±‡∏Å</button>
    </div>
    
    <div id="status" class="status">‚óè ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢!</div>
</div>

<audio id="sound" src="" preload="auto"></audio>

<script>
    let countdownTimer = null;
    let timeLeft = 0;

    const audio = document.getElementById('sound');
    const display = document.getElementById('countdown');
    const statusDiv = document.getElementById('status');
    const minutesInput = document.getElementById('minutesInput');
    const soundSelect = document.getElementById('soundSelect');
    const noteInput = document.getElementById('noteInput');

    window.onload = () => {
        noteInput.value = localStorage.getItem('myNote') || "";
        minutesInput.value = localStorage.getItem('myTime') || 30;
        soundSelect.value = localStorage.getItem('mySound') || soundSelect.options[0].value;
        audio.src = soundSelect.value;
    };

    function previewSound() {
        audio.src = soundSelect.value;
        audio.currentTime = 0;
        audio.play();
        localStorage.setItem('mySound', soundSelect.value);
    }

    async function requestPermission() {
        const perm = await Notification.requestPermission();
        if (perm === 'granted') {
            previewSound();
            alert("‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!");
        }
    }

    function updateDisplay(ms) {
        let totalSec = Math.max(0, Math.floor(ms / 1000));
        let m = Math.floor(totalSec / 60);
        let s = totalSec % 60;
        display.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function startTimer() {
        if (Notification.permission !== 'granted') return alert("‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
        
        const mins = parseInt(minutesInput.value) || 1;
        const duration = mins * 60 * 1000;
        
        stopTimer(); 
        localStorage.setItem('myNote', noteInput.value);
        localStorage.setItem('myTime', mins);

        sendNotify();
        
        timeLeft = duration;
        updateDisplay(timeLeft);
        
        countdownTimer = setInterval(() => {
            timeLeft -= 1000;
            if (timeLeft <= 0) {
                timeLeft = duration;
                sendNotify();
            }
            updateDisplay(timeLeft);
        }, 1000);

        statusDiv.innerText = "‚óè ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...";
        statusDiv.classList.add('working');
        toggleInputs(true);
    }

    function stopTimer() {
        clearInterval(countdownTimer);
        countdownTimer = null;
        display.innerText = "00:00";
        statusDiv.innerText = "‚óè ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
        statusDiv.classList.remove('working');
        toggleInputs(false);
    }

    function toggleInputs(disabled) {
        minutesInput.disabled = disabled;
        soundSelect.disabled = disabled;
        document.getElementById('startBtn').disabled = disabled;
    }

    function sendNotify() {
        const text = noteInput.value || "‡πÑ‡∏î‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß!";
        audio.src = soundSelect.value;
        audio.currentTime = 0;
        audio.play().catch(e => console.log(e));

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(reg => {
                reg.showNotification('üìå SOUND NOTES', {
                    body: text,
                    icon: 'https://cdn-icons-png.flaticon.com/512/564/564619.png',
                    vibrate: [300, 100, 300],
                    tag: 'sn-pwa'
                });
            });
        }
    }
</script>
</body>
</html>
